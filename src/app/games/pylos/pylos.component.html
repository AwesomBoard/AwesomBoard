<svg xmlns="http://www.w3.org/2000/svg"
     width="100%" height="auto"
     [attr.viewBox]="'0 0 ' + BOARD_WIDTH + ' ' + BOARD_HEIGHT"
     [attr.transform]="rotation"
     preserveAspectRatio="xMidYMid meet">

    <g *ngFor="let player of Player.PLAYERS">
        <circle *ngFor="let p of getPlayerSidePieces(player)"
                id="piece_{{ player.value }}_{{ p }}"
                [attr.cx]="(SPACE_SIZE / 2) + (STROKE_WIDTH / 2) + (((800 - SPACE_SIZE) / 14) * p)"
                [attr.cy]="getPiecesCyForPlayer(player)"
                [attr.r]="(SPACE_SIZE / 2) - STROKE_WIDTH"
                [ngClass]="getPlayerClass(player)"
                class="base mid-stroke"/>
    </g>

    <g #boardInItself
       [attr.transform]="'translate(' + (STROKE_WIDTH / 2) + ' ' + ((STROKE_WIDTH / 2) + PIECE_ROW_HEIGHT) + ')'">
        <rect x="0" y="0"
              width="800" height="800"
              class="base"
        />
        <g *ngFor="let z of [0, 1, 2]">
            <g *ngFor="let y of getLevelRange(z)">
                <g *ngFor="let x of getLevelRange(z)">
                    <ng-container *ngIf="mustDraw(x, y, z)">
                        <circle *ngIf="isOccupied(x, y, z) else onlyRect"
                                id="piece_{{ x }}_{{ y }}_{{ z }}"
                                (click)="onPieceClick(x, y, z)"
                                [attr.r]="getPieceRadius(z) - STROKE_WIDTH"
                                [attr.cx]="getPieceCx(x, y, z)"
                                [attr.cy]="getPieceCy(x, y, z)"
                                [ngClass]="getPieceClasses(x, y, z)"
                                class="base"
                        />
                        <ng-template #onlyRect>
                            <rect id="drop_{{ x }}_{{ y }}_{{ z }}"
                                  (click)="onDrop(x, y, z)"
                                  [attr.width]="getPieceRadius(z) * 2"
                                  [attr.height]="getPieceRadius(z) * 2"
                                  [attr.x]="getPieceCx(x, y, z) - getPieceRadius(z)"
                                  [attr.y]="getPieceCy(x, y, z) - getPieceRadius(z)"
                                  [ngClass]="getSquareClasses(x, y, z)"
                                  class="base"
                            />
                        </ng-template>
                    </ng-container>
                </g>
            </g>
        </g>
        <rect *ngIf="highCapture.isPresent()"
              id="highCapture_{{ highCapture.get().x }}_{{ highCapture.get().y }}_{{ highCapture.get().z }}"
              [attr.width]="getPieceRadius(highCapture.get().z) * 2"
              [attr.height]="getPieceRadius(highCapture.get().z) * 2"
              [attr.x]="getPieceCx(highCapture.get().x, highCapture.get().y, highCapture.get().z) - getPieceRadius(highCapture.get().z)"
              [attr.y]="getPieceCy(highCapture.get().x, highCapture.get().y, highCapture.get().z) - getPieceRadius(highCapture.get().z)"
              class="base captured"
        />
    </g>
</svg>

