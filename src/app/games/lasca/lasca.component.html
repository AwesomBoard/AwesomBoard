<svg xmlns="http://www.w3.org/2000/svg"
     width="100%" height="100%"
     [attr.viewBox]="LEFT + ' ' + UP + ' ' + WIDTH + ' ' + HEIGHT"
     preserveAspectRatio="xMidYMid meet">

    <defs>
        <g id="piece">
            <path d="M 0 25 v 15 a 40 25, 0, 0, 0, 80 0 v -15 a 40 25, 0, 0, 0, -80 0 Z"/>
            <ellipse cx="40" cy="25" rx="40" ry="25"/>
        </g>
    </defs>
    <!-- Empty board -->
    <g *ngFor="let coordAndContent of constructedState.getCoordsAndContents()"
       id="coord_{{ coordAndContent.coord.x }}_{{ coordAndContent.coord.y }}"
       [attr.transform]="getTranslationAtXYZ(coordAndContent.coord.x, coordAndContent.coord.y, 0)"
       (click)="onClick(coordAndContent.coord.x, coordAndContent.coord.y)">
        <polygon id="square_{{ coordAndContent.coord.x }}_{{ coordAndContent.coord.y }}"
                 [attr.points]="getParallelogramPoints()"
                 [ngClass]="getSquareClass(coordAndContent.coord.x, coordAndContent.coord.y)"
                 class="base" />
    </g>
    <rect id="bottomEdge"
          x="0"
          [attr.y]="basicWidth"
          [attr.width]="basicWidth * mode.horizontalWidthRatio"
          [attr.height]="THICKNESS"
          class="base"/>
    <polygon id="rightEdge"
             [attr.points]="getRightEdge()"
             class="base"/>

    <!-- Pieces -->
    <g *ngFor="let coordAndContent of constructedState.getCoordsAndContents()"
       id="coord_{{ coordAndContent.coord.x }}_{{ coordAndContent.coord.y }}"
       [attr.transform]="getTranslationAtXYZ(coordAndContent.coord.x, coordAndContent.coord.y, 0)"
       (click)="onClick(coordAndContent.coord.x, coordAndContent.coord.y)">
        <g *ngFor="let pieceInfo of coordAndContent.content.pieces; index as z"
           pointer-events="fill"
           [attr.transform]="getPieceTranslation(z)"
           class="base mid-small-stroke">
            <use id="square_{{ coordAndContent.coord.x }}_{{ coordAndContent.coord.y }}_piece_{{ z }}"
                 xlink:href="#piece"
                 [ngClass]="getPieceClasses(coordAndContent.coord.x, coordAndContent.coord.y, z)"
                 class="base mid-stroke"/>
            <circle id="square_{{ coordAndContent.coord.x }}_{{ coordAndContent.coord.y }}_piece_{{ z }}_officer_symbol"
                    *ngIf="isPieceOfficer(coordAndContent.coord.x, coordAndContent.coord.y, z)"
                    [attr.cx]="SPACE_SIZE * 0.4"
                    [attr.cy]="SPACE_SIZE * 0.575"
                    [attr.r]="SPACE_SIZE * 0.045"
                    [ngClass]="getPieceClasses(coordAndContent.coord.x, coordAndContent.coord.y, z)"/>
        </g>
    </g>
</svg>
