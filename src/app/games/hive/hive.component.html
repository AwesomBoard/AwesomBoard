<svg xmlns="http://www.w3.org/2000/svg"
     width="100%" height="100%"
     [attr.viewBox]="viewBox"
     preserveAspectRatio="xMidYMid meet">
    <g *ngFor="let y of ground.listKeys()">
        <g *ngFor="let x of ground.get(y).get().listKeys()">
            <polygon id="space_{{ x }}_{{y }}"
                     [attr.points]="getHexaCoordsAtXY(x, y)"
                     class="base mid-stroke"
                     [ngClass]="ground.get(y).get().get(x).get().spaceClasses"
                     (click)="selectSpace(x, y)"/>
        </g>
    </g>
    <g *ngFor="let y of ground.listKeys()">
        <g *ngFor="let x of ground.get(y).get().listKeys()">
            <polygon *ngIf="ground.get(y).get().get(x).get().strokeClasses.length > 0"
                     id="stroke_{{ x }}_{{ y }}"
                     [attr.points]="getHexaCoordsAtXY(x, y)"
                     class="base mid-stroke"
                     [ngClass]="ground.get(y).get().get(x).get().strokeClasses"
                     (click)="selectSpace(x, y)"/>
        </g>
    </g>
    <g *ngFor="let level of pieces; index as z">
        <g *ngFor="let line of level; index as y">
            <g *ngFor="let piece of line; index as x">
              <g *ngIf="piece !== undefined">
                <g id="piece_{{ x }}_{{ y }}"
                   app-hive-piece
                   [piece]="piece.piece"
                   [x]="x"
                   [y]="y"
                   [pieceHeight]="PIECE_HEIGHT"
                   [hexaLayout]="hexaLayout"
                   [level]="z"
                   (click)="selectStack(x, y)"/>
                </g>
            </g>
        </g>
        <g *ngFor="let line of level; index as y">
            <g *ngFor="let piece of line; index as x">
                <polygon *ngIf="piece !== undefined && piece.strokeClasses.length > 0"
                         id="stroke_{{ x }}_{{ y }}"
                         [attr.transform]="'translate(0 -' + (z+1) * PIECE_HEIGHT + ')'"
                         [attr.points]="getHexaCoordsAtXY(x, y)"
                         class="base no-fill mid-stroke"
                         [ngClass]="piece.strokeClasses"
                         (click)="selectStack(x, y)"/>
            </g>
        </g>
    </g>
    <g *ngFor="let stack of remainingPieces">
        <g *ngFor="let piece of stack.pieces; index as z">
            <g id="remainingPiece_{{ piece.toString() }}"
               app-hive-piece
               [attr.transform]="getRemainingPieceTransform(piece)"
               [piece]="piece"
               [pieceHeight]="PIECE_HEIGHT"
               [x]="0"
               [y]="0"
               [level]="z"
               [hexaLayout]="hexaLayout"
               (click)="selectRemaining(piece)"/>
        </g>
    </g>
    <polygon *ngIf="selectedRemaining.isPresent()"
             id="remaining_highlight"
             [attr.transform]="getRemainingPieceHighlightTransform(selectedRemaining.get())"
             [attr.points]="getHexaCoordsAt(ORIGIN)"
             class="base no-fill mid-stroke selected-stroke" />
    <g *ngIf="inspectedStack.isPresent()">
      <g *ngFor="let piece of inspectedStack.get().pieces.slice().reverse(); index as z"
          [attr.transform]="inspectedStackTransform"
          app-hive-piece
          [piece]="piece"
          [pieceHeight]="PIECE_HEIGHT"
          [x]="0"
          [y]="0"
          [hexaLayout]="hexaLayout"
          [level]="z*6"/>
    </g>
</svg>
