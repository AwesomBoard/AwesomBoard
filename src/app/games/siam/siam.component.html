<svg xmlns="http://www.w3.org/2000/svg"
     width="100%" height="auto"
     viewBox="-100 -100 900 900"
     preserveAspectRatio="xMidYMid meet">
    <defs>
        <polygon id="triangle" points="0 -6, 10 0, 0 6"/>
        <polygon id="arrow" points="30 7, 30 50, 10 50, 50 93, 90 50, 70 50, 70 7" />
        <polygon id="mountain" points="5 95, 16 68, 24 76, 48 28, 64 60, 72 44, 95 95, 5 95" />
    </defs>
    <ng-container *ngIf="isPlayerTurn()">
        <g *ngFor="let n of [0, 1, 2, 3, 4]">
            <use *ngFor="let orientation of [{ dir: 'DOWN', x: n, y: -1 }, { dir: 'UP', x: n, y: 5}, { dir: 'RIGHT', x: -1, y: n }, { dir: 'LEFT', x: 5, y: n }]"
                 xlink:href="#arrow"
                 id="insertAt_{{orientation.x}}_{{orientation.y}}"
                 (click)="insertAt(orientation.x, orientation.y)"
                 [attr.transform]="getArrowTransform(orientation.x+1, orientation.y+1, orientation.dir)"
                 class="base mid-stroke"/>
        </g>
    </ng-container>
    <g *ngFor="let line of board; index as y">
        <g *ngFor="let c of line; index as x">
            <rect id="insertAt_{{ x }}_{{ y }}"
                  (click)="insertAt(x, y)"
                  [attr.x]="SPACE_SIZE * (x + 1)"
                  [attr.y]="SPACE_SIZE * (y + 1)"
                  [attr.width]="SPACE_SIZE"
                  [attr.height]="SPACE_SIZE"
                  [ngClass]="getSquareClasses(x, y)"
                  class="base"
            />
            <g *ngIf="c.isPiece()">
                <use id="clickPiece_{{x}}_{{y}}"
                     class="base mid-stroke"
                     [ngClass]="getPieceClasses(c)"
                     (click)="clickPiece(x, y)"
                     xlink:href="#arrow"
                     [attr.transform]="getPieceTransform(x, y)"/>
                <g *ngIf="choosingDirection(x, y)">
                    <circle id="chooseDirection_"
                            class="arrow selected-fill no-stroke"
                            (click)="chooseDirection('')"
                            [attr.cx]="((x+1) * SPACE_SIZE) + SPACE_SIZE/2"
                            [attr.cy]="((y+1) * SPACE_SIZE) + SPACE_SIZE/2"
                            r="8"/>
                    <use *ngFor="let direction of ['RIGHT', 'DOWN', 'LEFT', 'UP']"
                         id="chooseDirection_{{direction}}"
                         class="arrow selected-fill no-stroke"
                         (click)="chooseDirection(direction)"
                         xlink:href="#triangle"
                         [attr.transform]="getTriangleTransform(x+1, y+1, direction)"/>
                </g>
            </g>
            <use *ngIf="isMountain(c)"
                 xlink:href="#mountain"
                 (click)="clickPiece(x, y)"
                 [attr.transform]="'translate(' + ((x+1) * SPACE_SIZE) + ' ' + ((y+1) * SPACE_SIZE) + ')'"
                 fill="brown" />
            <g *ngIf="choosingOrientation(x, y)">
                <use *ngFor="let orientation of ['RIGHT', 'DOWN', 'LEFT', 'UP']"
                     id="chooseOrientation_{{ orientation }}"
                     class="arrow selected-fill no-stroke"
                     (click)="chooseOrientation(orientation)"
                     xlink:href="#triangle"
                     [attr.transform]="getTriangleTransform(x+1, y+1, orientation)" />
            </g>
        </g>
    </g>
    <g *ngFor="let player of [Player.ZERO, Player.ONE]">
        <g *ngFor="let x of range(playerPieces(player))">
            <use class="base mid-stroke"
                 [ngClass]="getPlayerClass(player)"
                 id="{{x}}_{{ player }}"
                 (click)="selectPiece(Player.ZERO)"
                 xlink:href="#arrow"
                 [attr.transform]="getRemainingPieceTransform(x, player)"
            />
        </g>
    </g>
</svg>
