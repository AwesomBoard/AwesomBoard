<div class="container-fluid"
     style="height: 88%; max-height: 88%">

    <app-part-creation id="partCreation" #partCreation
                       *ngIf="gameStarted === false"
                       [partId]="currentPartId"
                       [userName]="userName"
                       (gameStartNotification)="startGame($event)">
    </app-part-creation>

    <div id="game"
         class="flex-container"
         *ngIf="gameStarted"
         [ngStyle] = "{ 'height': getGameHeight(), 'max-height': '100%' }">

         <div id="board"
              class="flex-container circled col-sm-9">
            <app-game-includer></app-game-includer>
        </div>

        <div id="info" class="circled col-sm-3">
            <div *ngIf="currentPart"
                 style="text-align:center"
                 class="inforow">
                <h4>Tour n° {{ currentPart.turn + 1 }}</h4>
            </div>
            <div *ngIf="players" class="inforow">
                <h4 style="float: left"> {{ players[0] }} </h4>
                <h4 style="float: right"> {{ players[1] }} </h4>
            </div>
            <div class="inforow">
                <app-count-down #chronoZeroGlobal
                                style="float: left"
                                debugName="chrono Zero Global"
                                (outOfTimeAction)="reachedOutOfTime(0)">
                </app-count-down>
                <app-count-down #chronoOneGlobal
                                style="float: right"
                                debugName="chrono One Global"
                                (outOfTimeAction)="reachedOutOfTime(1)">
                </app-count-down>
            </div>
            <div class="inforow">
                <app-count-down #chronoZeroLocal
                                style="float: left"
                                debugName="chrono Zero Local"
                                (outOfTimeAction)="reachedOutOfTime(0)">
                </app-count-down>
                <app-count-down #chronoOneLocal
                                style="float: right"
                                debugName="chrono One Local"
                                (outOfTimeAction)="reachedOutOfTime(1)">
                </app-count-down>
            </div>
            <div class="inforow" *ngIf="currentPart && compo && compo.showScore">
                <h4 style="float: left"> {{ compo.scores[0] }} pts </h4>
                <h4 style="float: right"> {{ compo.scores[1] }} pts </h4>
            </div>
            <ng-container *ngIf="!endGame else endGameBlock">
                <div class="inforow">
                    <h4>C'est à {{ currentPlayer===userName ? 'vous' : currentPlayer }}</h4>
                </div>
                <div *ngIf="opponent && observerRole < 2"
                     class="inforow">
                    <button mat-stroked-button
                            id="resignButton"
                            (click)="resign()">
                        Abandonner
                    </button>
                </div>
                <div *ngIf="observerRole < 2 && compo.canPass && (currentPlayer===userName)"
                     class="inforow">
                    <button mat-stroked-button
                            id="passButton"
                            (click)="compo.pass()">
                        Passer son tour
                    </button>
                </div>
                <ng-container *ngIf="isOpponentWaitingForTakeBackResponse() else askTakeBackContainer">
                    <div class="inforow">
                        <button mat-stroked-button
                                id="acceptTakeBackButton"
                                (click)="acceptTakeBack()">
                            Autoriser à reprendre un tour
                        </button>
                    </div>

                    <div class="inforow">
                        <button mat-stroked-button
                                id="refuseTakeBack"
                                (click)="refuseTakeBack()">
                            Refuser de reprendre un tour
                        </button>
                    </div>
                </ng-container>
                <ng-container #askTakeBackContainer
                              *ngIf="canAskTakeBack()">
                    <div class="inforow">
                        <button mat-stroked-button
                                id="askTakeBackButton"
                                (click)="askTakeBack()">
                            Demander à reprendre un coup
                        </button>
                    </div>
                </ng-container>
                <!--<div *ngIf="!endGame && (observerRole < 2)" class="inforow"> Proposer Match nul TODO </div>-->
            </ng-container>
            <ng-template #endGameBlock>
                <div class="inforow"
                     *ngIf="currentPart.winner != null else noWinner">
                    <h4 *ngIf="(currentPart.winner === userName)"> Vous avez gagné </h4>
                    <h4 *ngIf="(currentPart.winner !== userName) && (observerRole < 2)"> Vous avez perdu </h4>
                    <h4 *ngIf="(currentPart.winner !== userName) && (observerRole >= 2)"> Victoire de {{ currentPart.winner }} </h4>
                </div>
                <ng-template #noWinner>
                    <div class="inforow">
                        <h4> Match nul </h4>
                    </div>
                </ng-template>
                <div class="inforow">
                    <button mat-stroked-button
                            routerLink="server">
                        Retour au serveur
                    </button>
                </div>
                <div *ngIf="observerRole < 2"
                     class="inforow">
                    <button mat-stroked-button
                            *ngIf="!rematchProposed"
                            (click)="proposeRematch()">
                        Proposer un rematch
                    </button>
                    <button mat-stroked-button
                            *ngIf="rematchProposed && opponentProposedRematch"
                            (click)="acceptRematch()">
                        Accepter le rematch
                    </button>
                </div>
            </ng-template>
        </div>
    </div>

    <div id="chat"
         class="circled"
         [ngStyle] = "{ 'height': getChatHeight(), 'max-height': '40%', 'float': 'bottom' }">
        <app-chat #chatComponent
                  [chatId]="currentPartId"
                  [turn]="currentPart?.turn"></app-chat>
    </div>

</div>
